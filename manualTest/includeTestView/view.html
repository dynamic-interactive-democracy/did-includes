<!DOCTYPE html>
<html>
    <head>
        <title>manual test</title>
        <link rel="stylesheet" type="text/css" href="/assets/lib.css">
        <script src="/assets/lib.en_US.js"></script>
    </head>
    <body>
        <div class="circle-container">(If this text persists, loading failed.)</div>
        <script>
            var did = require("did")("http://localhost:3001", {
                users: {
                    view: (id) => alert("viewing user " + id + " not supported.")
                },
                circles: {
                    view: (id) => location.href = location.protocol + "//" + location.host + "/circles/view?id=" + id,
                    edit: (id) => location.href = location.protocol + "//" + location.host + "/circles/edit?id=" + id
                },
                topics: {
                    create: (circleId) => location.href = location.protocol + "//" + location.host + "/topics/create?circleId=" + circleId,
                    view: (circleId, id) => location.href = location.protocol + "//" + location.host + "/topics/view?circleId=" + circleId + "&id=" + id,
                    edit: (circleId, id) => location.href = location.protocol + "//" + location.host + "/topics/edit?circleId=" + circleId + "&id=" + id
                }
            });
            did.api.asUser("sphinx", "399810c258af4960eca01949ff7a6ff7dbf2c130983f67347cb18bf979b9aa6af6354402001899ac9215e53411c8e7bbaebb62360b26678a98371d39461f3259");
            
            var setUp = {{ & setUpFun }};
            var info = setUp(did, getParameterByName);
            var include = info.include;
            document.title = info.title + " " + document.title;

            include.renderIn(document.querySelector(".circle-container"));

            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }
        </script>
    </body>
</html>
